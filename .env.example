# GitHub Actions Self-Hosted Runner Configuration
# Copy this file to .env and fill in your values

# =============================================================================
# REQUIRED SETTINGS
# =============================================================================

# GitHub repository URL (https://github.com/owner/repo)
# Or organization URL (https://github.com/org)
GITHUB_URL=https://github.com/your-org/your-repo

# GitHub Personal Access Token
# Required scopes:
# - For repository runners: repo
# - For organization runners: admin:org
# - For autoscaling: also needs admin:repo_hook or admin:org_hook to manage webhooks
GITHUB_TOKEN=ghp_your_token_here

# =============================================================================
# AUTOSCALING SETTINGS (for docker-compose.autoscale.yml)
# =============================================================================

# --- Webhook Configuration (choose one option) ---

# Option A: Auto-registration (recommended)
# Set WEBHOOK_HOST to your server's public URL. The controller will:
# - Generate a secure webhook secret automatically
# - Register/update the webhook with GitHub API
# - Persist the secret to /data/webhook_secret for restarts
# Requires: admin:repo_hook (repo) or admin:org_hook (org) scope on your token
WEBHOOK_HOST=https://your-public-server.com

# Option B: Manual configuration
# Set WEBHOOK_SECRET and configure the webhook manually in GitHub settings
# If neither WEBHOOK_HOST nor WEBHOOK_SECRET is set, a secret will be
# auto-generated and printed to logs for manual configuration
# WEBHOOK_SECRET=your_webhook_secret_here

# Port for webhook server (default: 8080)
WEBHOOK_PORT=8080

# Maximum number of concurrent ephemeral runners (default: 10)
MAX_RUNNERS=10

# Docker image for ephemeral runners
RUNNER_IMAGE=ghcr.io/depoll/gh-runner-docker:ephemeral

# Docker network for runners (default: gh-runner-network)
DOCKER_NETWORK=gh-runner-network

# =============================================================================
# RUNNER SETTINGS (for both modes)
# =============================================================================

# Runner name prefix (default: "runner")
# In autoscaling mode, runners are named: ephemeral-runner-{job_id}-{uuid}
RUNNER_NAME_PREFIX=runner

# Runner working directory (default: "_work")
RUNNER_WORKDIR=_work

# Comma-separated list of labels for runners
# Self-hosted runners should include: self-hosted,linux
RUNNER_LABELS=self-hosted,linux

# Runner group (default: "default")
RUNNER_GROUP=default

# =============================================================================
# STATIC POOL SETTINGS (for docker-compose.yml)
# =============================================================================

# Number of static runner replicas (default: 3)
REPLICAS=3

# Deployment ID for grouping runners (optional)
DEPLOYMENT_ID=

# =============================================================================
# NOTES
# =============================================================================
#
# Autoscaling Mode (docker-compose.autoscale.yml):
# ------------------------------------------------
# - Spawns ephemeral runners on-demand when jobs are queued
# - Each runner processes exactly one job then exits
# - Webhook setup options:
#
#   Auto-registration (set WEBHOOK_HOST):
#   - Controller registers webhook automatically with GitHub API
#   - Secret is generated and persisted automatically
#   - Requires admin:repo_hook or admin:org_hook token scope
#
#   Manual setup (set WEBHOOK_SECRET, leave WEBHOOK_HOST empty):
#   1. Go to Settings > Webhooks > Add webhook
#   2. Payload URL: http://your-server:8080/webhook
#   3. Content type: application/json
#   4. Secret: (same as WEBHOOK_SECRET)
#   5. Events: Select "Workflow jobs"
#
# Static Pool Mode (docker-compose.yml):
# --------------------------------------
# - Maintains a fixed pool of long-running runners
# - Good for consistent workloads
# - Simpler setup, no webhook required