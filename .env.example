# GitHub Actions Self-Hosted Runner Configuration
# Copy this file to .env and fill in your values

# =============================================================================
# REQUIRED SETTINGS
# =============================================================================

# GitHub repository URL (https://github.com/owner/repo)
# Or organization URL (https://github.com/org)
GITHUB_URL=https://github.com/your-org/your-repo

# GitHub Personal Access Token
# Required scopes:
# - For repository runners: repo
# - For organization runners: admin:org
# - For autoscaling: also needs admin:repo_hook or admin:org_hook to manage webhooks
GITHUB_TOKEN=ghp_your_token_here

# =============================================================================
# AUTOSCALING SETTINGS (for docker-compose.autoscale.yml)
# =============================================================================

# --- Webhook Configuration (choose one option) ---

# Option A: Auto-registration (recommended)
# Set WEBHOOK_HOST to your server's public URL. The controller will:
# - Generate a secure webhook secret automatically
# - Register/update the webhook with GitHub API
# - Persist the secret to /data/webhook_secret for restarts
# Requires: admin:repo_hook (repo) or admin:org_hook (org) scope on your token
WEBHOOK_HOST=https://your-public-server.com

# Option B: Manual configuration
# Set WEBHOOK_SECRET and configure the webhook manually in GitHub settings
# If neither WEBHOOK_HOST nor WEBHOOK_SECRET is set, a secret will be
# auto-generated and printed to logs for manual configuration
# WEBHOOK_SECRET=your_webhook_secret_here

# Maximum number of concurrent ephemeral runners (default: 10)
MAX_RUNNERS=10

# Docker image for ephemeral runners
RUNNER_IMAGE=ghcr.io/depoll/gh-runner-docker:ephemeral

# Docker network for runners (default: gh-runner-network)
DOCKER_NETWORK=gh-runner-network

# =============================================================================
# HTTPS / TLS SETTINGS (for production deployments)
# =============================================================================

# Domain name for the webhook endpoint (required for HTTPS)
WEBHOOK_DOMAIN=webhook.example.com

# Email for Let's Encrypt certificate notifications (if using certbot)
LETSENCRYPT_EMAIL=admin@example.com

# This repo's nginx image includes the nginx ACME module and can obtain/renew
# Let's Encrypt certificates automatically when WEBHOOK_DOMAIN + LETSENCRYPT_EMAIL
# are set and ports 80/443 are reachable.
#
# First boot note:
# - nginx will generate a temporary self-signed cert at /etc/nginx/acme/fullchain.pem
#   and /etc/nginx/acme/privkey.pem so it can start immediately.
# - The ACME module will replace it with a real Let's Encrypt certificate once
#   validation succeeds.

# =============================================================================
# RUNNER SETTINGS (for both modes)
# =============================================================================

# Runner name prefix (default: "runner")
# In autoscaling mode, runners are named: ephemeral-runner-{job_id}-{uuid}
RUNNER_NAME_PREFIX=runner

# Runner working directory (default: "_work")
RUNNER_WORKDIR=_work

# Comma-separated list of labels for runners
# Self-hosted runners should include: self-hosted,linux
RUNNER_LABELS=self-hosted,linux

# Runner group (default: "default")
RUNNER_GROUP=default

# =============================================================================
# STATIC POOL SETTINGS (for docker-compose.yml)
# =============================================================================

# Number of static runner replicas (default: 3)
REPLICAS=3

# Deployment ID for grouping runners (optional)
DEPLOYMENT_ID=

# =============================================================================
# NOTES
# =============================================================================
#
# Autoscaling Mode (docker-compose.autoscale.yml):
# ------------------------------------------------
# - Spawns ephemeral runners on-demand when jobs are queued
# - Each runner processes exactly one job then exits
# - Includes nginx reverse proxy (bring your own certificates for HTTPS)
#
# HTTPS Setup:
#   1. Obtain certificates (e.g., via certbot, acme.sh, or cloud provider)
#   2. Mount certificates to /etc/nginx/acme/fullchain.pem and privkey.pem
#   3. Set WEBHOOK_DOMAIN to your public domain
#   4. Ensure ports 80 and 443 are accessible from the internet
#   5. DNS must point to your server
#   6. Run: docker-compose -f docker-compose.autoscale.yml up -d
#
# Webhook auto-registration (set WEBHOOK_HOST):
#   - Controller registers webhook automatically with GitHub API
#   - Secret is generated and persisted automatically
#   - Requires admin:repo_hook or admin:org_hook token scope
#   - Set WEBHOOK_HOST to https://your-domain.com (matches WEBHOOK_DOMAIN)
#
# Manual webhook setup (set WEBHOOK_SECRET, leave WEBHOOK_HOST empty):
#   1. Go to Settings > Webhooks > Add webhook
#   2. Payload URL: https://your-domain.com/webhook
#   3. Content type: application/json
#   4. Secret: (same as WEBHOOK_SECRET)
#   5. Events: Select "Workflow jobs"
#
# Static Pool Mode (docker-compose.yml):
# --------------------------------------
# - Maintains a fixed pool of long-running runners
# - Good for consistent workloads
# - Simpler setup, no webhook required